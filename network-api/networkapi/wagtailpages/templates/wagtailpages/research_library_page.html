{% extends "./research_base.html" %}
{% load i18n static wagtailcore_tags wagtailimages_tags %}

{% block hero_guts %}
  <div id="hero">
    <div class="banner tw-bg-black">
      {% with banner=page.specific.get_banner %}
        {% if banner %}
          <picture>
            <source media="(min-width: 1200px)" srcset="{% image_url banner "fill-4032x1152" %}">
            <source media="(min-width: 992px)" srcset="{% image_url banner "fill-2400x686" %}">
            <source media="(min-width: 768px)" srcset="{% image_url banner "fill-1984x567" %}">
            <source media="(min-width: 576px)" srcset="{% image_url banner "fill-1536x439" %}">
            <img src="{% image_url banner "fill-1536x439" %}" alt="">
          </picture>
        {% else %}
          <img src="{% static "_images/banner-black-white-marble.jpg" %}" alt="">
        {% endif %}
      {% endwith %}
    </div>
  </div>
{% endblock %}

{% block subcontent %}
  {# The relative position is necessary to allow this container to overflow the banner image #}
  <div class="tw-container tw-relative tw-w-auto tw-mt-[6rem] tw-pt-4 small:tw-pt-7 tw-ml-0 small:tw-ml-auto tw-mr-4 small:tw-mr-auto tw-pr-0 small:tw-pr-4 small:tw-pb-[3rem] tw-bg-white">
    <div>
      <div>
        {# Replace this with real breadcrumbs #}
        Research /
      </div>
      <h1>{{ page.title }}</h1>
    </div>

    <div class="tw-mt-5 tw-mb-4 medium:tw-bg-gray-05 medium:tw-w-[26rem] medium:tw-h-[9rem]" >
      {% comment %}
        The page url is necessary in the form to that the filter anchor link is not carried forward.
        Say on mobile the user used the "Filter" anchor link to get to the filter section,
        that adds the `#filter` part to the URL. Submitting the form in that stage without the
        explicit URL would carry the anchor link forward. That would mean the view is scrolled to the
        filter section again upon page reload. This seems undesireable.
      {% endcomment %}
      <form action="{% pageurl page %}" method="get" accept-charset="utf-8" id="search-form">
        {% include "wagtailpages/fragments/research_search_bar.html" %}
      </form>
    </div>

    <div class="tw-flex tw-flex-col medium:tw-flex-row-reverse">
      {# FILTER, SORT AND RESULTS #}

      {# For side-by-side layout, we need to pull the results up to that the upper end lines up with the search bar. #}
      <div class="tw-min-w-0 medium:-tw-mt-[9rem] tw-pb-7">
        {# SORT AND RESULTS #}

        <div class="tw-flex tw-flex-row tw-gap-3">
          {# SORT CONTROLS #}

          <a href="#filter" class="tw-relative tw-btn-secondary tw-flex tw-items-center small:tw-hidden tw-w-1/2 tw-px-3 tw-py-[5px] tw-text-left tw-text-base tw-font-normal hover:tw-text-white active:tw-text-white tw-border tw-border-gray-40 tw-text-inherit hover:tw-no-underline tw-align-middle">
            <span>Filter</span>
            <svg fill="currentColor" height="14" viewBox="0 0 14 14" width="14" xmlns="http://www.w3.org/2000/svg" stroke="none" class="tw-absolute tw-top-1/2 -tw-translate-y-1/2 tw-right-2"><path d="m14 8h-6v6h-2v-6h-6v-2h6v-6h2v6h6z"/></svg>
          </a>
          {% if search_query %}
            <div class="tw-hidden small:tw-block">
              {% blocktranslate count results_count=research_detail_pages.count trimmed %}
                <strong>{{ results_count }}</strong> result for <q>{{ search_query }}</q>
                {% plural %}
                <strong>{{ results_count }}</strong> results for <q>{{ search_query }}</q>
              {% endblocktranslate %}
            </div>
          {% endif %}
          <div class="tw-flex tw-flex-row tw-items-baseline tw-w-1/2">
            <select name="sort" class="tw-form-control tw-border-gray-40" form="search-form" onchange="this.form.submit()">
              {% for choice in page.SORT_CHOICES.values  %}
                <option value="{{ choice.value }}" {% if choice == sort %}selected{% endif %}>{{ choice.label }}</option>
              {% endfor %}
            </select>
            <noscript>
              {# The sort button is only needed for the no JS case. With JS, the form can be submitted on change of the select #}
              <button type="submit" class="tw-btn-primary tw-text-base" form="search-form">{% translate 'Sort' context 'Button' %}</button>
            </noscript>
          </div>
        </div>

        <ul class="tw-list-none tw-mt-7 tw-mb-5 tw-px-0 tw-border-t tw-border-b tw-border-gray-20 tw-divide-y tw-divide-gray-05">
          {# RESULTS LIST #}
          {% for research_detail_page in research_detail_pages  %}
            <li class="tw-m-0 tw-pt-5 tw-pb-5">
              {% include "wagtailpages/fragments/research_detail_card.html" with research_detail_page=research_detail_page hide_image_on_mobile=True hide_topics_on_mobile=True %}
            </li>
          {% endfor %}
        </ul>
        {% comment %}
          Pagination goes here.
        {% endcomment %}
      </div>

      <div id="filter" class="-tw-mx-4 tw-px-4 tw-pt-7 tw-pb-7 medium:tw-w-[26rem] tw-shrink-0 tw-bg-gray-05 ">
        <div class="tw-pt-4 tw-border-t">
          <fieldset>
            <legend><h2>{% translate 'Topics' %}</h2></legend>
            <ul class="tw-list-none tw-pl-0">
              {% for topic in topic_options|dictsort:"name" %}
                <li class="tw-flex tw-flex-row tw-items-baseline">
                  <input type="checkbox" value="{{ topic.id }}" name="topic" id="topic-option-{{ topic.id }}" {% if topic.id in filtered_topic_ids %}checked{% endif %} form="search-form" class="rh-checkbox" />
                  <label for="topic-option-{{ topic.id }}" >{{ topic.name }}</label>
                </li>
              {% endfor %}
            </ul>
          </fieldset>
        </div>
        <div>
          <fieldset>
            <legend><h2>{% translate 'Publication date' %}</h2></legend>
            <ul class="tw-list-none tw-pl-0">
              <li class="tw-flex tw-flex-row tw-items-baseline">
                <input type="radio" value="" name="year" id="year-option-all" {% if not filtered_year %}checked{% endif %} form="search-form" class="rh-radio" />
                <label for="year-option-all">{% translate 'Any' context 'Option in a radio button list of years' %}</label>
              </li>
              {% for year in year_options %}
                <li class="tw-flex tw-flex-row tw-items-baseline">
                  <input type="radio" value="{{ year }}" name="year" id="year-option-{{ year }}" {% if year == filtered_year %}checked{% endif %} form="search-form" class="rh-radio" />
                  <label for="year-option-{{ year }}">{{ year }}</label>
                </li>
              {% endfor %}
            </ul>
          </fieldset>
        </div>
        <div>
          <fieldset>
            <legend><h2>{% translate 'Authors' %}</h2></legend>
            <ul class="tw-list-none tw-pl-0">
              {% for author in author_options|dictsort:"name" %}
                <li class="tw-flex tw-flex-row tw-items-baseline">
                  <input type="checkbox" value="{{ author.id }}" name="author" id="author-option-{{ author.id }}" {% if author.id in filtered_author_ids %}checked{% endif %} form="search-form" class="rh-checkbox" />
                  <label for="author-option-{{ author.id }}">{{ author.name }}</label>
                </li>
              {% endfor %}
          </fieldset>
            </ul>
        </div>
        <div>
          <fieldset>
            <legend><h2>{% translate 'Regions' %}</h2></legend>
            <ul class="tw-list-none tw-pl-0">
              {% for region in region_options|dictsort:"name" %}
                <li class="tw-flex tw-flex-row tw-items-baseline">
                  <input type="checkbox" value="{{ region.id }}" name="region" id="region-option-{{ region.id }}" {% if region.id in filtered_region_ids %}checked{% endif %} form="search-form" class="rh-checkbox"/>
                  <label for="region-option-{{ region.id }}">{{ region.name }}</label>
                </li>
              {% endfor %}
            </ul>
          </fieldset>
        </div>
        <button type="submit" class="tw-w-full tw-btn-primary" form="search-form">{% translate 'Apply filters' context 'Button' %}</button>
      </div>
    </div>

  </div>
{% endblock subcontent %}
